---
title: "[Paper Review] StyleGAN2 : Analyzing and Improving the Image Quality of StyleGAN ë…¼ë¬¸ ë¶„ì„"
excerpt: "ê¸°ì¡´ì˜ styleganì„ ë°œì „ì‹œí‚¨ nvidia researchì˜ StyleGAN2ì— ëŒ€í•´ ì•Œì•„ë³¸ë‹¤."

categories:
 - GAN
tags:
  - deeplearning
  - ai
  - pytorch
  - GAN
  - vision
search: true

# ëª©ì°¨
toc: true  
toc_sticky: true 

use_math: true
---

> âœğŸ» ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” ê¸°ì¡´ì˜ styleganì„ ë°œì „ì‹œí‚¨ nvidia researchì˜ **StyleGAN2**ì— ëŒ€í•´ ì‚´í´ë³¸ë‹¤.


- Paper : [Analyzing and Improving the Image Quality of StyleGAN](https://arxiv.org/abs/1912.04958) (2020 / Tero Karras, Samuli Laine, Miika Aittala, Janne Hellsten, Jaakko Lehtinen, Timo Aila)
          
- [GAN-Zoos! (GAN í¬ìŠ¤íŒ… ëª¨ìŒì§‘)](https://happy-jihye.github.io/gan/)

---

> ë³¸ ë…¼ë¬¸ì€ ê¸°ì¡´ì˜ SoTAì˜€ë˜ StyleGANì˜ architectureë¥¼ ë°œì „ì‹œì¼œ ìƒˆë¡œìš´ SoTAì˜ ê²°ê³¼ë¥¼ ë‚¸ ë…¼ë¬¸ìœ¼ë¡œ, í˜„ì¬ ì—°êµ¬ë˜ê³  ìˆëŠ” ë§ì€ ìƒì„±ëª¨ë¸ë“¤ì€ stylegan v2ë¥¼ baselineìœ¼ë¡œ í•˜ê³  ìˆë‹¤. 

## 1. Introduction

- [[Paper Review] StyleGAN : A Style-Based Generator Architecture for Generative Adversarial Networks ë…¼ë¬¸ ë¶„ì„](https://happy-jihye.github.io/gan/gan-6/)

ê¸°ì¡´ì˜ styleGANì€ input latent code $\mathbf{z} \in \mathcal{Z}$ ëŒ€ì‹ , mapping network $f$ë¥¼ ë„ì…í•˜ì˜€ë‹¤.(intermediate latent code $\mathbf{w} \in \mathcal{W}$ ) ë˜í•œ, Affine transformì„ ì‚¬ìš©í•˜ì—¬ styleì„ ìƒì„±í–ˆìœ¼ë©° stochastic variationì„ ì£¼ê¸° ìœ„í•´ noiseë¥¼ ì‚¬ìš©í–ˆë‹¤.


**Problem**

ì´ë¯¸ì§€ì˜ feature mapì—ì„œ ê³„ì†í•´ì„œ ì •ì²´ë¶ˆëª…ì˜ ë¬¼ë°©ìš¸ì´ ìƒê¹€

> â­ StyleGAN2ëŠ” Gì˜ normalizationì„ ë‹¤ì‹œ ë””ìì¸ í•˜ì—¬ ë¬¼ë°©ìš¸ì„ ì œê±°í•˜ê³ , Progressive Growingì´ ì•„ë‹Œ ë‹¤ë¥¸ training ë°©ì‹ì„ ì‚¬ìš©í•˜ì—¬ ê³ í•´ìƒë„ì˜ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ì˜€ë‹¤. 


## 2. Removing normalization artifacts

<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/stylegan2-1.PNG?raw=1' width = '800' ></p>

StyleGANì—ì„œ ìƒì„±ëœ ì´ë¯¸ì§€ë“¤ì€ ë¬¼ë°©ìš¸ê³¼ ê°™ì€ <span style='background-color: #FFF2CC;'> **blob-shaped artifacts** </span>ë“¤ì´ ìƒê²¼ì—ˆë‹¤. (ê·¸ë¦¼1)
ì´ í˜„ìƒì€ ëª¨ë“  feature mapì—ì„œ ë‚˜íƒ€ë‚˜ë©°, ê³  í•´ìƒë„ì˜ ì´ë¯¸ì§€ì¼ìˆ˜ë¡ ê°•í•˜ê²Œ ë‚˜íƒ€ë‚œë‹¤.

### 2.1 Generator architecture revisited

<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/stylegan2-2.PNG?raw=1' width = '450' ></p>


[ê¸°ì¡´ì˜ StyleGAN v1](https://happy-jihye.github.io/gan/gan-6/)ì€ style block ë‚´ì—ì„œ biasì™€ noiseì„ ì ìš©í–ˆì—ˆëŠ”ë°, ì´ ë•Œë¬¸ì— **styleì´ ì˜¤íˆë ¤ í˜„ì¬ styleì˜ í¬ê¸°ì— ë°˜ë¹„ë¡€í•˜ê²Œ ì ìš©ë˜ì—ˆë‹¤**. <span style='background-color: #E5EBF7;'>stylegan2ì—ì„œëŠ” **bias & noiseë¥¼ styleblock ì™¸ë¶€ë¡œ** ì˜®ê²¨ì£¼ì–´ ì´ë¥¼ í•´ê²°í•˜ì˜€ë‹¤.  </span>

- **Instance Normalization** : AdaINì„ ì—†ì• ê³  feature mapë§ˆë‹¤ í‰ê· ê³¼ í‘œì¤€í¸ì°¨ë¥¼ ê³„ì‚°
  - `AdaINì„ ì—†ì• ëŠ” ì´ìœ ` : blob-shaped artifactsì´ ì™œ ìƒê¸°ëŠ”ì§€ì— ëŒ€í•œ ëª…í™•í•œ ì›ì¸ì€ ëª»ì°¾ì•˜ì§€ë§Œ, ì´ëŠ” AdaIN ë•Œë¬¸ì— ìƒê¸°ëŠ” ê²ƒìœ¼ë¡œ ì¶”ì¸¡ëœë‹¤. (styleganì—ì„œ normalizationë¥¼ ì—†ì• ë‹ˆ ë¬¼ë°©ìš¸ì´ ìƒê¸°ëŠ” í˜„ìƒë“¤ì´ ì‚¬ë¼ì§€ëŠ” ê²ƒì„ ë°œê²¬) ë”°ë¼ì„œ v2ì—ì„œëŠ” ì´ë¥¼ ì œê±°í•˜ì˜€ë‹¤.
- **modulation**ì„ í†µí•´ scaling & biasing

<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/stylegan2-3.PNG?raw=1' width = '450' ></p>

- <span style='background-color: #FFF2CC;'> **Blue block** </span> : noiseë¥¼ ë”í•´ì£¼ëŠ” ë¶€ë¶„ê³¼ biasë¥¼ ë”í•´ì£¼ëŠ” ë¶€ë¶„ì„ normalizationì´í›„ë¡œ ì˜®ê¹€
  - <span style='background-color: #E2F0D9;'> **why?** </span> : noiseëŠ” ë³´í†µ gaussian ì •ê·œë¶„í¬ì—ì„œ ë½‘ëŠ”ë°, conv layerì´í›„ì— ì´ ê°’ì„ ë”í•´ì£¼ë©´ noiseì˜ ê°’ì´ ë¹„êµì  ì‘ìœ¼ë¯€ë¡œ ì´ ì˜í–¥ì´ ë°˜ì˜ë˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆë‹¤. ë”°ë¼ì„œ conv layerì˜ ê²°ê³¼ê°’ì„ normalizeí•´ì¤€ í›„ì— ì´ noiseë¥¼ ë”í•´ì£¼ì—ˆë‹¤. 

- <span style='background-color: #FFF2CC;'> **Red block** </span> : ì‹¤í—˜ì„ í•´ë³´ë‹ˆ í‰ê· (mean)ì„ êµ¬í•˜ì§€ ì•Šê³  í‘œì¤€í¸ì°¨(standard deviation)ë§Œì„ ì‚¬ìš©í•˜ì—¬ë„ normalizationê³¼ modulationì„ í•  ìˆ˜ ìˆìŒì„ í™•ì¸í•˜ì˜€ë‹¤.
  - normalizeë¥¼ í•´ì¤„ ë•Œ meanê°’ì„ ë¹¼ì£¼ëŠ” ê³¼ì •ì„ ì•ˆí•´ì¤˜ë„ ë¨

- <span style='background-color: #FFF2CC;'> **Green block** </span> : ì´ˆê¸°ì˜ Learned constant inputì—ì„œ bias, noise, normalizationì„ í•´ì£¼ì§€ ì•Šì•„ë„ ë³„ë‹¤ë¥¸ ì„±ëŠ¥ ì €í•˜ê°€ ë‚˜íƒ€ë‚˜ì§€ ì•Šì•„ì„œ ì´ë“¤ë„ ì œê±°í•´ì£¼ì—ˆë‹¤.

### 2.2 Instance normalization revisited

<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/stylegan2-5.PNG?raw=1' width = '500' ></p>

- Revised architecture(c)ëŠ” **modulation, convolution, normalization**ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ìˆë‹¤.
  
---

<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/stylegan2-4.jpg?raw=1' width = '600' ></p>

- StyleGAN2ì˜ ìµœì¢… ëª¨ë¸ì¸ (d)ì—ì„œëŠ” <span style='background-color: #FFF2CC;'> **ê° feature mapì—ì„œ modulation(scaling)ì„ í•˜ëŠ” ëŒ€ì‹ , convolutional weightì— modulationì„ í•´ì£¼ì—ˆë‹¤.** </span>
  - weightë¥¼ modulationí•˜ëŠ”ê²Œ featureë¥¼ modulationí•˜ëŠ” ê²ƒë³´ë‹¤ í•™ìŠµì†ë„ê°€ ë¹ ë¦„
$$w_{i j k}^{\prime}=s_{i} \cdot w_{i j k}$$

  - original weight $w_{i j k}$ì— scaling $s_i$ì„ í•´ì¤Œ â†’ modulated weight $w_{i j k}^{\prime}$
  
- instance normalizationì€ output feature mapì´ scalingë˜ì§€ ì•Šë„ë¡ ì •ê·œí™”ë¥¼ í•˜ëŠ” ê³¼ì •ì´ë‹¤.(Varianceë¥¼ 1ë¡œ ë§Œë“œëŠ” ê³¼ì •) stylegan2ì—ì„œëŠ” weightì— scalingì„ í•˜ë¯€ë¡œ conv ì—°ì‚° í›„ì—ë„ scalingì´ ë˜ì–´ìˆì§€ ì•Šë„ë¡ convolution layerì˜ weightë¥¼ ì¡°ì •í•´ì£¼ì—ˆë‹¤.
  
  - <span style='background-color: #FFF2CC;'> â­ (ê°€ì •) : input feature mapì˜ í‘œì¤€í¸ì°¨(standard deviation)ëŠ” 1, i.i.d random variables </span>

  - modulationê³¼ convolution í›„ì— í‘œì¤€í¸ì°¨ëŠ” $\sigma_{j}=\sqrt{\sum_{i, k} w_{i j k}^{\prime} 2}$

  - ë”°ë¼ì„œ output feature mapì˜ ë¶„ì‚°ë„ 1ì´ ë˜ë„ë¡ ë‹¤ì‹œ scalingì„ í•´ì¤Œ : <span style='background-color: #E2F0D9;'> **Demodulation** </span> $w_{i j k}^{\prime \prime}=w_{i j k}^{\prime} / \sqrt{\sum_{i, k} w_{i j k}^{\prime}2+\epsilon}$

> instance normalizationì€ í•­ìƒ varianceë¥¼ 1ë¡œ ë§Œë“¤ì–´ì¤€ë‹¤ëŠ” ì¥ì ì´ ìˆì§€ë§Œ, blob-like artifactë¥¼ ë§Œë“¤ê³¤ í•œë‹¤. ë”°ë¼ì„œ stylegan2ì—ì„œëŠ” IN ëŒ€ì‹  Weight Demodulationì´ë¼ëŠ” ì •ê·œí™” ë°©ì‹ì„ ì‚¬ìš©í•˜ì˜€ë‹¤.(WDëŠ” íŠ¹ì • ê°€ì •ì—ì„œë§Œ ì„±ë¦½ë˜ëŠ” ì•½í•œ ì •ê·œí™”)

<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/stylegan2-6.PNG?raw=1' width = '450' ></p>

ìƒì„± ì´ë¯¸ì§€ì— ë¬¼ë°©ìš¸ì´ ìƒê¸°ëŠ” í˜„ìƒë“¤ì´ ì‚¬ë¼ì¡Œë‹¤. (FIDë„ ê±°ì˜ ê·¸ëŒ€ë¡œ)

## 3. Image quality and generator smoothness

<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/stylegan2-7.PNG?raw=1' width = '700' ></p>

> FIDë‚˜ P&R(Precision and Recall)ì´ ê°™ë”ë¼ë„ PPLì´ ë‚®ì€ ì‚¬ì§„ì´ ì§ˆì´ ë” ì¢‹ë‹¤.

<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/stylegan2-8.PNG?raw=1' width = '500' ></p>

> [PPL(Perceptual Path Length)](https://happy-jihye.github.io/gan/gan-6/#41-perceptual-path-lengthppl)ì´ ë‚®ì„ ìˆ˜ë¡ high-quality imageë¥¼ ë§Œë“ ë‹¤.

<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/stylegan2-9.PNG?raw=1' width = '500' ></p>

> stylegan1ì— ë¹„í•´ stylegan2ì˜ PPLì´ ì‘ë‹¤ğŸ˜Š

---
### 3.1 Lazy regularization

StyleGANì€ non-saturated adversarial lossì¸ **BCE lossì™€ R1 regularization**ì„ ì‚¬ìš©í•œë‹¤.

> ë³´í†µ **BCE lossì™€ R1 regularization**ì˜ ì¡°í•©ì„ ë§ì´ ì‚¬ìš© âœ”

ë‹¤ë§Œ `stylegan v1`ì€ R1 regë¥¼ ë§¤ iterationë§ˆë‹¤ í•´ì¤¬ë‹¤ë©´, `stylegan v2`ì—ì„œëŠ” computation costë¥¼ ì¤„ì´ê¸° ìœ„í•´ R1 regë¥¼ ë§¤ë²ˆ í•´ì£¼ì§€ëŠ” ì•ŠëŠ”ë‹¤. (ex. 16 iterationì— í•œë²ˆ) 

ë”°ë¼ì„œ **Lazy regularization**ì´ë¼ê³  ë¶€ë¥¸ë‹¤.


$$R_{1}(\psi)=\frac{\gamma}{2} E_{p_{D}(x)}\left[\left\|\nabla D_{\psi}(x)\right\|^{2}\right]$$

---

### 3.2 Path Length Regularization

$$\mathbb{E}_{\mathbf{w}, \mathbf{y} \sim \mathcal{N}(0, \mathbf{I})}\left(\left\|\mathbf{J}_{\mathbf{w}}^{T} \mathbf{y}\right\|_{2}-a\right)^{2}$$

- PPL regularizationì„ ë¹¼ë„ stylegan2ì´ ì–´ëŠì •ë„ ì˜ ë™ì‘í•¨.
- ìì„¸í•œ ì„¤ëª…ì€ ìƒëµ

## 4. Progressive growing revisited



<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/stylegan2-10.PNG?raw=1' width = '600' ></p>

[PGGAN](https://happy-jihye.github.io/gan/gan-5/)ì€ ê³ í•´ìƒë„ì˜ ì´ë¯¸ì§€ë¥¼ ì˜ ìƒì„±í•˜ì§€ë§Œ, <span style='background-color: #FFF2CC;'> **Phase artifacts(strong location)**ë¬¸ì œ </span>ê°€ ìˆë‹¤.
- **Phase artifacts(strong location)**: ëˆˆë™ìë‚˜ ì´ë¹¨ì˜ ëª¨ì–‘ì€ ì˜ ìƒì„±ì´ ë˜ì§€ë§Œ, ìì„¸ë¥¼ ë°”ê¿”ë„ ìœ„ì¹˜ê°€ ê³ ì •(Figure 6)

`PGGAN`ì˜ architectureë¥¼ ë”°ë¥´ëŠ” `stylegan` ì—­ì‹œ ë™ì¼í•œ ë¬¸ì œê°€ ìƒê²¨ `stylegan v2`ì—ì„œëŠ” ì´ë¥¼ í•´ê²°í•˜ê³ ì progressive growingì˜ í•™ìŠµë°©ì‹ì„ ì±„íƒí•˜ì§€ ì•Šì•˜ë‹¤.

---
### 4.1 Alternative network architectures

- progressive growingì˜ ë°©ì‹ì„ ë”°ë¥´ì§€ ì•Šê³ ë„ high-qualityì˜ ì´ë¯¸ì§€ë¥¼ ì˜ ìƒì„±í•  ìˆ˜ ìˆë„ë¡ styleGANì„ ë³€í˜•

<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/stylegan2-11.PNG?raw=1' width = '800' ></p>

ë³¸ ë…¼ë¬¸ì€ ì„¸ê°€ì§€ì˜ Generatorì™€ Discriminatorì˜ architectureì— ëŒ€í•´ ì‹¤í—˜ì„ í–ˆìœ¼ë©°, ì´ ì¤‘ <span style='background-color: #E5EBF7;'> **skip generatorì™€ residual discriminator**ì˜ ë°©ì‹ìœ¼ë¡œ architectureë¥¼ êµ¬ì„±í•˜ì˜€ë‹¤. </span>

---
### 4.2 Resolution usage
 
> Progresive Growingì—ì„œëŠ” Generatorê°€ low-resolution featureì— ì§‘ì¤‘ì„ í•˜ë‹¤ê°€ ì„œì„œíˆ finer detailì„ ì¡ì•„ê°€ëŠ” ë°©ì‹ìœ¼ë¡œ í•™ìŠµì„ í•œë‹¤ë©´, ìœ„ì˜ StyleGANì—ì„œëŠ” Gê°€ low-resolutionì˜ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ë‹¤ ì ì°¨ high-resolutionì˜ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ í•™ìŠµì„ í•œë‹¤.

<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/stylegan2-12.PNG?raw=1' width = '500' ></p>

(b)ëŠ” (a)ë³´ë‹¤ channelì˜ ìˆ˜ë¥¼ ëŠ˜ë¦° ê²½ìš°ì´ë‹¤. 

ê¸°ì¡´ì˜ setting (a)ì—ì„œëŠ” ê³  í•´ìƒë„(1024)ì—ì„œ filterì˜ ì˜í–¥ë ¥ì´ ì‘ì•„ varianceê°€ ì‘ì•˜ë‹¤ë©´, channel sizeë¥¼ ëŠ˜ë ¸ì„ ë•Œì—ëŠ” generatorê°€ high-resolutionì˜ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.  

## 5. Projection of images to latent space

<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/stylegan2-14.PNG?raw=1' width = '800' ></p>

ë‹¤ìŒì€ ìƒì„±ëœ ì´ë¯¸ì§€ë¥¼ latent spaceë¡œ projectioní•œ í›„ì—, ê·¸ latent spaceë¥¼ ì´ìš©í•´ ë‹¤ì‹œê¸ˆ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•œ ê²°ê³¼ì´ë‹¤.
- random init `z`ì—ì„œ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•œ í›„, target ì´ë¯¸ì§€ì™€ ê°€ì¥ ë¹„ìŠ·í•œ ì´ë¯¸ì§€ì˜ latent spaceë¥¼ ì°¾ëŠ” ë°©ì‹ìœ¼ë¡œ projectionì„ í•¨.

> `StyleGAN v1`ì€ ìê¸° ìì‹ ì´ ìƒì„±í•œ ì´ë¯¸ì§€ì— ëŒ€í•´ì„œë„ projectionì„ ì˜ ëª»í•˜ì§€ë§Œ, `StyleGAN v2`ëŠ” ìì‹ ì´ ìƒì„±í•œ ì´ë¯¸ì§€ì— ëŒ€í•´ì„œëŠ” latent spaceë¡œ projectionì„ ì˜ ì‹œí‚¨ë‹¤. 

<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/stylegan2-15.PNG?raw=1' width = '500' ></p>

LPIPS distanceë¥¼ ê³„ì‚°í•´ë³´ë©´, StyleGANì€ realì™€ ìƒì„± ì´ë¯¸ì§€ë¥¼ ì˜ êµ¬ë³„ ëª»í•˜ì§€ë§Œ StyleGAN2ëŠ” êµ¬ë³„ì„ ì˜ í•œë‹¤.


## 6. Conclusions

<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/stylegan2-13.PNG?raw=1' width = '800' ></p>

ìœ„ì—ì„œ ì œì‹œí•œ styleGAN2ì˜ ê¸°ë²•ì„ ì‚¬ìš©í•˜ë©´ ì„±ëŠ¥ì´ ì¢‹ì•„ì§„ë‹¤.

---
<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/stylegan2-16.PNG?raw=1' width = '600' ></p>

> StyleGAN2ëŠ” StyleGANì˜ architectureë¥¼ ê°œì„ í•˜ì—¬ blob-shaped artifactsë¬¸ì œë¥¼ í•´ê²°í•˜ê³  high-qualityì˜ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ì˜€ë‹¤.