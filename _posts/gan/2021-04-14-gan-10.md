---
title: "[Paper Review] CycleGAN : Unpaired Image-to-Image Translation using Cycle-Consistent Adversarial Networks ë…¼ë¬¸ ë¶„ì„"
excerpt: "unpaired datasetì— ëŒ€í•´ì„œë„ Image-to-Image translationì„ í•˜ëŠ” CycleGAN modelì— ëŒ€í•´ ì•Œì•„ë³¸ë‹¤."


date: 2021-04-14
categories:
 - GAN
tags:
  - deeplearning
  - ai
  - pytorch
  - GAN
  - vision
search: true

# ëª©ì°¨
toc: true  
toc_sticky: true 

use_math: true
---

> âœğŸ» ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” unpaired datasetì— ëŒ€í•´ì„œë„ Image-to-Image translationì„ í•˜ëŠ” **CycleGAN model**ì— ëŒ€í•´ ì‚´í´ë³¸ë‹¤.


- Paper : [[CycleGAN] Unpaired Image-to-Image Translation using Cycle-Consistent Adversarial Networks](https://arxiv.org/abs/1703.10593) (ICCV 2017/ Jun-Yan Zhu, Taesung Park, Phillip Isola, Alexei A. Efros)

- [GAN-Zoos! (GAN í¬ìŠ¤íŒ… ëª¨ìŒì§‘)](https://happy-jihye.github.io/gan/)

---

<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/cyclegan1.PNG?raw=1' width = '800' ></p>

ê·¸ë™ì•ˆì˜ Image-to-image translationì€ ìŒì´ ìˆëŠ” datasetì— ëŒ€í•´ì„œë§Œ í•™ìŠµì´ ë˜ì—ˆë‹¤. <span style='background-color: #E5EBF7;'> í•˜ì§€ë§Œ ì‹¤ì œë¡œ ë§ì€ taskë“¤ì—ì„œëŠ” *paired training data*ê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤. ë³¸ ë…¼ë¬¸ì—ì„œëŠ” mapping network $G: X \rightarrow Y$ì™€ inverse mapping $F: Y \rightarrow X$ë¥¼ í•™ìŠµì‹œì¼œ unpaired training dataì— ëŒ€í•´ì„œë„ image-to-imageê°€ ê°€ëŠ¥í•˜ë„ë¡ í•˜ì˜€ë‹¤. </span>

<span style='background-color: #E2F0D9;'> ë˜í•œ, $F(G(X)) \approx X$ ì˜ ì‹ì´ ë§Œì¡±í•˜ë„ë¡ **cycle consistency loss** ë¥¼ ë„ì…í•˜ì˜€ìœ¼ë©°, ì´ ëª¨ë¸ì€ style transfer, object transfiguration, season transfer, photo enhancement ë“± ë‹¤ì–‘í•œ taskì˜ image-to-image ë³€í™˜ì„ ê°€ëŠ¥í•˜ê²Œ í–ˆë‹¤. </span>

- ë³¸ ë…¼ë¬¸ì€ [Pix2Pix](https://arxiv.org/abs/1611.07004)ì˜ í›„ì† ì—°êµ¬ì´ë‹¤. (Image-to-Image Translation with Conditional Adversarial Networks ë…¼ë¬¸ ë¦¬ë·°ëŠ” [ì´ ê¸€](https://happy-jihye.github.io/gan/gan-8/) ì°¸ê³ )

## 1. Introduction

> ë³¸ ë…¼ë¬¸ì—ì„œëŠ” **(1) image collectionì—ì„œ íŠ¹ë³„í•œ íŠ¹ì„±ì„ captureí•˜ëŠ” ë°©ë²•**ê³¼ **(2) paired training datasetì´ ì—†ì–´ë„ ì´ íŠ¹ì„±ì„ ë‹¤ë¥¸ image collectionìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ë²•**ì„ ì œì•ˆí•œë‹¤.

<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/cyclegan2.PNG?raw=1' width = '450' ></p>

paired training dataë¥¼ ì°¾ëŠ”ê±´ ì–´ë µê³  costê°€ ë§ì´ ë“ ë‹¤. ë”°ë¼ì„œ CycleGANì—ì„œëŠ” input-outputì˜ pair ì—†ì´ë„ domainê°„ ë³€í™˜ì´ ê°€ëŠ¥í•œ ì•Œê³ ë¦¬ì¦˜ì„ ì°¾ê³ ì í•œë‹¤.

ì´ë•Œ, ë‹¨ìˆœíˆ $G: X \rightarrow Y$ë¡œ mappingì„ í•œ í›„, ìƒì„±ëœ ì´ë¯¸ì§€ $\hat{y}=G(x)$ê°€ $y \in Y$ì™€ ë¹„ìŠ·í•˜ë„ë¡ í•™ìŠµì„ ì‹œí‚¤ë©´ ì•ˆëœë‹¤. ì´ëŸ°ì‹ìœ¼ë¡œ í•™ìŠµì„ ì‹œí‚¬ ê²½ìš°ì—ëŠ” $x$ê°€ $y$ë‘ ì˜ mappingì´ ë ì§€ ëª…í™•í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì´ë‹¤. 
- âœ” (ë¬¸ì œ) ëŒ€ë‹¤ìˆ˜ì˜ $G$ê°€ í•˜ë‚˜ì˜ $\hat{y}$ë¡œ mappingë  ìˆ˜ë„ ìˆê³ , mode collapseë¡œ ë¹ ì§ˆ ìˆ˜ë„ ìˆìŒ

ë”°ë¼ì„œ ë³¸ ë…¼ë¬¸ì—ì„œëŠ” translationì´ ë°˜ë“œì‹œ **Cycle consistent**ë˜ì–´ì•¼ë§Œ í•œë‹¤ëŠ” íŠ¹ì§•ì„ ì¶”ê°€í•˜ì˜€ë‹¤. (ì˜ì–´ë¥¼ ë…ì¼ì–´ë¡œ ë²ˆì—­í•  ìˆ˜ ìˆìœ¼ë©´, ë…ì¼ì–´ë„ ì˜ì–´ë¡œ ë²ˆì—­í•  ìˆ˜ ìˆì–´ì•¼í•˜ëŠ”ê²Œ cycle consistent!)

$$G: X \rightarrow Y$$

$$F: Y \rightarrow X$$

ë˜í•œ, <span style='background-color: #E5EBF7;'> $F(G(x)) \approx x$, $G(F(y)) \approx y$ì˜ **cycle consistency loss** </span>ë„ ì¶”ê°€í•˜ì˜€ë‹¤.

## 2. Related Work

- Generative Adversarial Networks (GANs)
- Image-to-Image Translation
- Unpaired Image-to-Image Translation
- Cycle Consistency
- Neural Style Transfer
- ìì„¸í•œ ë‚´ìš©ì€ ìƒëµ

## 3. Formulation

<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/cyclegan5.PNG?raw=1' width = '700' ></p>

> **CycleGANì˜ object function**ì€ ìƒì„±ëœ ì´ë¯¸ì§€ì™€ ì‹¤ì œ ì´ë¯¸ì§€ê°„ì˜ lossì¸ **(1) Adversarial losses**ì™€ Gì™€ Fê°€ ì˜ matchingë˜ë„ë¡ í•™ìŠµì‹œí‚¤ëŠ” **(2) Cycle consistency losses**ë¡œ êµ¬ì„±ëœë‹¤.

### 3.1 Adversarial Losses

- $G: X \rightarrow Y$ì™€ $D_Y$ì— ëŒ€í•œ object function
  
$$\begin{aligned}
\mathcal{L}_{\mathrm{GAN}}\left(G, D_{Y}, X, Y\right) &=\mathbb{E}_{y \sim p_{\text {data }}(y)}\left[\log D_{Y}(y)\right] \\
&+\mathbb{E}_{x \sim p_{\text {data }}(x)}\left[\log \left(1-D_{Y}(G(x))\right]\right.
\end{aligned}$$

$$\min _{G} \max _{D_{Y}} \mathcal{L}_{\mathrm{GAN}}\left(G, D_{Y}, X, Y\right)$$

- $F$ì— ëŒ€í•´ì„œë„ ìœ ì‚¬í•œ adversarial lossë¥¼ ì ìš©í•œë‹¤.
$$\min_{F} \max _{D_{X}} \mathcal{L}_{\mathrm{GAN}}\left(F, D_{X}, Y, X\right)$$

---

### 3.2 Cycle Consistency Loss

ë‹¨ìˆœíˆ adversarial lossë§Œì„ í•™ìŠµí•˜ë©´ mode collapse ë¬¸ì œê°€ ìƒê¸¸ ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ unpaired datasetì— ëŒ€í•´ì„œë„ dataë“¤ì´ ì˜ mappingë˜ë„ë¡ Cycle consistency loss(L1 loss)ë¥¼ ì¶”ê°€ì ìœ¼ë¡œ í•™ìŠµì‹œí‚¨ë‹¤.

<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/cyclegan3.PNG?raw=1' width = '800' ></p>

- forward cycle-consistencyì—ì„œëŠ” $x \rightarrow G(x) \rightarrow F(G(x)) \approx x$ë¥¼
- backward cycle-consistencyì—ì„œëŠ” $y \rightarrow F(y) \rightarrow G(F(y)) \approx y$ë¥¼ í•™ìŠµí•œë‹¤.

- **Cycle Consistency Loss**
  
$$\begin{aligned}
\mathcal{L}_{\text {cyc }}(G, F) &=\mathbb{E}_{x \sim p_{\text {data }}(x)}\left[\|F(G(x))-x\|_{1}\right] \\
&+\mathbb{E}_{y \sim p_{\text {data }}(y)}\left[\|G(F(y))-y\|_{1}\right]
\end{aligned}$$


---

**Reconstruct Image**

<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/cyclegan4.PNG?raw=1' width = '500' ></p>

> âœğŸ» CycleGANì€ unpaired datasetì— ëŒ€í•´ í•™ìŠµì„ ì‹œí‚¤ëŠ” ëª¨ë¸ì´ë‹¤. ë”°ë¼ì„œ train datasetì—ì„œ pairingì„ í•˜ê¸° ìœ„í•´ Aì—ì„œ Bë¡œ ì´ë¯¸ì§€ë¥¼ ìƒì„±í–ˆì„ ë•Œ, Bì—ì„œ Aë¡œ **ë³µì›**í•  ìˆ˜ ìˆë„ë¡ í•™ìŠµì„ ì‹œì¼°ë‹¤. 
> 
> ë‹¤ìŒ ê·¸ë¦¼ì„ ë³´ë©´ input $x$ì—ì„œ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ê³ $G(x)$, ë‹¤ì‹œ í•œë²ˆ Aë¡œ ë³µì›í•˜ëŠ” ê²ƒ($F(G(x))$)ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

---

**Result**

<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/cyclegan7.PNG?raw=1' width = '800' ></p>
<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/cyclegan6.PNG?raw=1' width = '500' ></p>

**GAN + forward cycle loss**ë‚˜ **GAN + backward cycle loss**ë§Œì„ í•˜ë©´ í•™ìŠµì´ ë¶ˆì•ˆì •í•´ì§€ê³  mode collapseê°€ ë°œìƒí•œë‹¤. 

- GAN + forward cycle loss : 
$$\mathbb{E}_{x \sim p_{\text {data }}(x)}\left[\|F(G(x))-x\|_{1}\right]$$

- GAN + backward cycle loss : 
$$\mathrm{E}_{y \sim p_{\text {data }}(y)}\left[\|G(F(y))-y\|_{1}\right]$$

ë”°ë¼ì„œ ì–‘ë°©í–¥ì˜ cycle lossë¥¼ í†µí•´ í•™ìŠµì„ ì‹œì¼œì•¼í•œë‹¤.

---

### 3.3 Full Object

$$\begin{aligned}
\mathcal{L}\left(G, F, D_{X}, D_{Y}\right) &=\mathcal{L}_{\mathrm{GAN}}\left(G, D_{Y}, X, Y\right) +\mathcal{L}_{\mathrm{GAN}}\left(F, D_{X}, Y, X\right) \\
&+\lambda \mathcal{L}_{\mathrm{cyc}}(G, F)
\end{aligned}$$

$\lambda$ëŠ” adversarial lossì˜ ì¤‘ìš”ë„ì— ë”°ë¼ ìƒëŒ€ì ìœ¼ë¡œ ê²°ì •í•œë‹¤. ë…¼ë¬¸ì˜ ì‹¤í—˜ì—ì„œëŠ” $\lambda = 10$ì˜ ê°’ì„ ì‚¬ìš©í•˜ì˜€ë‹¤.

$$G^{*}, F^{*}=\arg \min _{G, F} \max _{D_{x}, D_{Y}} \mathcal{L}\left(G, F, D_{X}, D_{Y}\right)$$

## 4. Implementation

Generator ëª¨ë¸ì˜ baselineìœ¼ë¡œëŠ” [Pix2pix](https://happy-jihye.github.io/gan/gan-8)ë¥¼ ì‚¬ìš©í•œë‹¤.

- 3ê°œì˜ convolution
- ì—¬ëŸ¬ê°œì˜ residual block(=skip connection)
- 2ê°œì˜ fractionally-strided convolution (stride = $\frac{1}{2}$)
  - Transposed convolution, deconvolutionìœ¼ë¡œë„ ë¶ˆë¦°ë‹¤. 
  - [DCGAN](https://happy-jihye.github.io/gan/gan-2/#dcgan-architecture)ì—ì„œë„ ì‚¬ìš©ë˜ì—ˆìŒ
- `128 x 128` imagesì—ëŠ” 6ê°œì˜ blockì„, `256 x 256` ì´ìƒì˜ high-resolution imageì—ëŠ” 9ê°œì˜ blockì„ ì‚¬ìš©
- instance normalization
- DiscriminatorëŠ” `70 x 70`ì˜ [PatchGAN](https://happy-jihye.github.io/gan/gan-8/#322-markovian-discriminator-patchgan)ì„ ì‚¬ìš©

ë˜í•œ, ê¸°ì¡´ì—ëŠ” GANì˜ loss functionìœ¼ë¡œ negative log likelihood lossë¥¼ ì‚¬ìš©í–ˆë‹¤ë©´,

$$\begin{aligned}
\mathcal{L}_{\mathrm{GAN}}\left(G, D_{Y}, X, Y\right) &=\mathbb{E}_{y \sim p_{\text {data }}(y)}\left[\log D_{Y}(y)\right] \\
&+\mathbb{E}_{x \sim p_{\text {data }}(x)}\left[\log \left(1-D_{Y}(G(x))\right]\right.
\end{aligned}$$

CycleGANì—ì„œëŠ” ì´ë¥¼ **Least-squares Loss**ë¡œ ë°”ê¿¨ë‹¤.

- minimize G :
$$\mathbb{E}_{x \sim p_{\text {data }}(x)}\left[(D(G(x))-1)^{2}\right]$$
- minimize D :
$$\mathbb{E}_{y \sim p_{\text {data }}(y)}\left[(D(y)-1)^{2}\right]+\mathbb{E}_{x \sim p_{\text {data }}(x)}\left[D(G(x))^{2}\right]$$

- ì´ë ‡ê²Œ í•˜ë©´ vanishing gradientë¬¸ì œë¥¼ í•´ê²°í•˜ì—¬ í•™ìŠµì„ ì•ˆì •ì ìœ¼ë¡œ í•  ìˆ˜ ìˆë‹¤.

## 5. Experiments

<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/cyclegan8.PNG?raw=1' width = '700' ></p>
<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/cyclegan9.PNG?raw=1' width = '500' ></p>

ë‹¤ë¥¸ modelë³´ë‹¤ CycleGANì´ ì¢‹ë‹¤.

---

<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/cyclegan10.PNG?raw=1' width = '700' ></p>

paired datasetì— ëŒ€í•´ ì‹¤í—˜ì„ í•œ pix2pixì™€ ë¹„êµí•´ë´ë„ cycleganì€ ë¹„ìŠ·í•œ ì„±ëŠ¥ì„ ë‚¸ë‹¤ !ğŸ˜®

## 6. Applications

**Style Transfer**
<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/cyclegan11.PNG?raw=1' width = '800' ></p>

styleì„ ë³€í˜•ì‹œí‚¤ëŠ” ê²ƒë„ ê°€ëŠ¥í•˜ë‹¤.

---

**Object transfiguration**
<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/cyclegan12.PNG?raw=1' width = '800' ></p>

ë¹„ìŠ·í•œ ì¹´í…Œê³ ë¦¬ë¡œ transfigurationë„ ê°€ëŠ¥í•˜ë‹¤.

---

**Phto generation from paintings**
<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/cyclegan13.PNG?raw=1' width = '800' ></p>
---
<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/cyclegan14.PNG?raw=1' width = '600' ></p>

ê·¸ë¦¼ì„ ì‚¬ì§„ìœ¼ë¡œ ë°”ê¿”ì¤„ ë•Œ ì¶”ê°€ì ì¸ lossë¥¼ ë„ì…í•˜ì˜€ë‹¤.

$$\mathcal{L}_{\text {identity }}(G, F)=\mathbb{E}_{y \sim p_{\text {data }}(y)}\left[\|G(y)-y\|_{1}\right]+\mathbb{E}_{x \sim p_{\text {dta }}(x)}\left[\|F(x)-x\|_{1}\right]$$

## 7. Limitations and Discussion

<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/cyclegan15.PNG?raw=1' width = '800' ></p>
ìœ„ì˜ ê·¸ë¦¼ì²˜ëŸ¼ í•™ìŠµì´ ì˜ ì•ˆëœ ê²½ìš°ë„ ì¡´ì¬í•œë‹¤. ë³´í†µì€ training datasetì— ì—†ëŠ” dataê°€ ì£¼ì–´ì¡Œì„ ë•Œ í•™ìŠµì— ì‹¤íŒ¨ë¥¼ í•˜ê³¤ í•œë‹¤. 

`horse -> zebra`ë¥¼ ë³´ë©´, ImageNetì—ëŠ” ë§ê³¼ ì–¼ë£©ë§ì˜ ë°ì´í„°ëŠ” ë§ì•„ ì´ì— ëŒ€í•´ í•™ìŠµì€ í–ˆì§€ë§Œ, ë§ì„ íƒ€ê³  ìˆëŠ” ì‚¬ëŒì— ëŒ€í•´ì„œëŠ” í•™ìŠµì„ í•˜ì§€ ëª»í•´ í•™ìŠµì— ì‹¤íŒ¨í–ˆë‹¤.


> ê·¸ë˜ë„ **ë³¸ ë…¼ë¬¸ì€ unpaired data(unsupervised setting)ì— ëŒ€í•´ íš¨ê³¼ì ì¸ image-to-image taskë¥¼ ìˆ˜í–‰í–ˆë‹¤.**

## 8. Opinion

> âœğŸ» ê¸°ì¡´ì˜ pix2pixì˜ ë…¼ë¬¸ì— ìƒˆë¡œìš´ ì•„ì´ë””ì–´ í•˜ë‚˜ë¥¼ ë”í•´ ì¢‹ì€ ê²°ê³¼ë¥¼ ë‚¸ ë…¼ë¬¸ì´ë‹¤. ì´ì „ ë…¼ë¬¸ë¶€í„° í•˜ë‚˜ì”© ë°œì „í•´ë‚˜ê°€ëŠ” ëª¨ë¸ì„ ë³´ë‹ˆ ì¬ë°Œì—ˆë‹¤.
>
> ë…¼ë¬¸ ìì²´ë„ ì‰½ê²Œ ì“°ì—¬ì§„ í¸ì´ë¼ ì½ê¸° í¸í–ˆë˜ ê²ƒ ê°™ë‹¤. cycleganì€ ê´€ë ¨ applicationì´ ë‹¤ì–‘í•˜ë˜ë°, ì´ë¥¼ í† ëŒ€ë¡œ ì¬ë¯¸ìˆëŠ” projectë¥¼ ë§Œë“¤ì–´ë³´ê³  ì‹¶ë‹¤!ğŸ˜Š

---
**Reference**
- Naver AI LAB ìµœìœ¤ì œ ì—°êµ¬ì›ë‹˜ ë°œí‘œìë£Œ