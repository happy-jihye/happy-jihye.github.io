---
title: "[Paper Review] MocoGAN-HD: A Good Image Generator Is What You Need for High-Resolution Video Synthesis"
excerpt: ""


categories:
 - GAN
tags:
  - deeplearning
  - ai
  - GAN
  - vision
search: true

# ëª©ì°¨
toc: true  
toc_sticky: true 

use_math: true
---


- Paper : `MocoGAN-HD`: A Good Image Generator Is What You Need for High-Resolution Video Synthesis (ICLR 2021) ([arxiv](https://arxiv.org/abs/2104.15069), [code](https://github.com/snap-research/MoCoGAN-HD), [project](https://bluer555.github.io/MoCoGAN-HD/))
  - `MoCoGAN`: Decomposing Motion and Content for Video Generation (CVPR 2018) ([arxiv](https://arxiv.org/abs/1707.04993), [code](https://github.com/sergeytulyakov/mocogan))
- [GAN-Zoos! (GAN í¬ìŠ¤íŒ… ëª¨ìŒì§‘)](https://happy-jihye.github.io/gan/)

---


> `MocoGAN-HD`: ê¸°ì¡´ì˜ SoTA generatorì¸ StyleGANê³¼ BigGANì˜ pre-trained modelì„ ì´ìš©í•˜ì—¬ latent vectorë¥¼ manipulationí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë¹„ë””ì˜¤ë¥¼ ìƒì„±í•˜ëŠ” ëª¨ë¸ì´ë‹¤. GeneratorëŠ” ê³ ì •ì‹œí‚¨ ìƒíƒœì—ì„œ latent vectorë§Œì„ ì¡°ì ˆí•˜ì—¬ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ëŠ” ì»¨ì…‰ì´ë¼ ìƒˆë¡­ì§€ëŠ” ì•Šì•˜ë‹¤. 
> 
> íŠ¹ì´í–ˆë˜ ì ì€ ì´ ëª¨ë¸ì´ poseë¥¼ ì°¾ëŠ” ë°©ì‹ìœ¼ë¡œ `motion generator`ë¼ëŠ” LSTM modelì„ ì´ìš©í–ˆë‹¤ëŠ” ì ì´ë‹¤. LSTM ëª¨ë¸ì„ ì ìš©í•˜ì—¬ disentangleí•œ latent trajectoryë¥¼ ì°¾ì•˜ë‹¤ëŠ” ì ì´ í¥ë¯¸ë¡œì› ë‹¤. 


<b>ì €ìë“¤ì´ ì£¼ì¥í•œ contribution</b>
1. <b>High-resolution videos</b>ë¥¼ ìƒì„±í•  ìˆ˜ ìˆì§€ë§Œ, computation resourceê°€ ë§ì´ ì•ˆë“¦
    - ğŸ¤”: baseline modelë¡œ bigganê³¼ styleganì„ ì‚¬ìš©í•´ì„œ ê·¸ëŸ°ê±°ë¼.. ë‹¹ì—°í•œ ìˆ˜ìˆœì´ ì•„ë‹Œê°€ ì‹¶ìŒ.. 
2. <font color='#2C4D88'>contentì™€ motionì´ disentangleí•œ ìƒíƒœì—ì„œ ì›í•˜ëŠ” latent trajectoryë¥¼ ì°¾ì„ ìˆ˜ ìˆëŠ” <b>motion generator</b> ë°œê²¬</font>
3. <b>cross-domain video synthesis</b>: ë‹¤ë¥¸ domainì˜ datasetë“¤ì— ëŒ€í•˜ì—¬ image & motion generatorë¥¼ í›ˆë ¨í•˜ì—¬ ë¹„ë””ì˜¤ë¥¼ í•©ì„±í•  ìˆ˜ ìˆìŒ 

<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/mocoganhd-1.PNG?raw=1' width = '700' ></p>

## 1. Generator
### 1.1 <i>pre-trained</i> Image Generator $G_I$

- Image Generatorë¡œëŠ” StyleGANê³¼ BigGANì˜ pretrained modelì„ ì‚¬ìš©
- í›ˆë ¨ê³¼ì •ì—ì„œ fixë˜ê¸° ë•Œë¬¸ì— image contentì˜ video motionì´ disentangleí•  ìˆ˜ ìˆìœ¼ë©°, ì„œë¡œ ë‹¤ë¥¸ domainì—ì„œì˜ video í•©ì„±ì´ ê°€ëŠ¥í•´ì§ 
  - voxceleb datasetìœ¼ë¡œ motionì„ captureí•œ í›„, ffhq-styleganì˜ generatorë¥¼ ì´ìš©í•˜ì—¬ ë¹„ë””ì˜¤ë¥¼ í•©ì„±í•˜ëŠ” ë°©ì‹(cross-domain) 

### 1.2 <i>pre-trained</i> Motion Generator $G_M$

#### LSTM network
- `Motion Generator`: ë‘ ê°œì˜ `LSTM network(LSTM encoder, LSTM decoder)`ë¥¼ ì´ìš©í•˜ì—¬ latent motion <i>trajectory</i> ë¥¼ ì˜ˆì¸¡ 
  - `latent motion trajectory`: $\mathbf{Z}=\left\{\mathbf{z}_{1}, \mathbf{z}_{2}, \cdots, \mathbf{z}_{n}\right\}$ 
  - $n$: number of frames
  - latent vector: BigGANì€ normal distribution $p_z$ì—ì„œ, StyleGANì€ MLPì—ì„œ

$$\mathbf{h}_{1}, \mathbf{c}_{1}=\operatorname{LSTM}_{\text {enc }}\left(\mathbf{z}_{1}\right)$$

$$\mathbf{h}_{t}, \mathbf{c}_{t}=\operatorname{LSTM}_{\text {dec }}\left(\epsilon_{t},\left(\mathbf{h}_{t-1}, \mathbf{c}_{t-1}\right)\right), \quad t=2,3, \cdots, n$$

- LSTM encoderë¡œ initial hidden stateì™€ cell stateë¥¼ ì–»ì€ í›„, ì´í›„ë¶€í„°ëŠ” LSTM decoderë¥¼ í†µí•´ $n-1$ê°œì˜ continuous hidden stateë¥¼ ê³„ì‚°
  - $\epsilon_{t}$ : noise vector

- image generatorì˜ inputìœ¼ë¡œ latent vectorë¥¼ ë„£ì–´ ë¹„ë””ì˜¤ì˜ ì´ë¯¸ì§€ë“¤ì„ ìƒì„±: $\tilde{\mathbf{x}}_{t}=G_I(z_t)$

$$\tilde{\mathbf{v}}=\left\{\tilde{\mathbf{x}}_{1}, \tilde{\mathbf{x}}_{2}, \cdots, \tilde{\mathbf{x}}_{n}\right\}$$

- real video clip

$$\mathbf{v}=\left\{\mathbf{x}_{1},\mathbf{x}_{2}, \cdots, \mathbf{x}_{n}\right\}$$

#### Motion Disentanglement

- [SeFA](https://happy-jihye.github.io/gan/gan-25/#21-sefa)ë‚˜ [GanSpace](https://happy-jihye.github.io/gan/gan-25/#22-ganspace) ì²˜ëŸ¼ latent spaceì˜ interpretable directionì„ ì°¾ê¸°
  - sefa: Closed-Form Factorization of Latent Semantics in GANs (CVPR 2021) : [arxiv](https://arxiv.org/abs/2007.06600), [code](https://github.com/happy-jihye/GAN/tree/main/SEFA), [review](https://happy-jihye.github.io/gan/gan-25/#21-sefa)
  - GANSpace: Discovering Interpretable GAN Controls (NeurIPS 2020) : [arxiv](https://arxiv.org/abs/2004.02546), [code](https://github.com/harskish/ganspace), [review](https://happy-jihye.github.io/gan/gan-25/#22-ganspace)
- PCA(principal component analysis)ë¡œ latent vectorì— ëŒ€í•œ ê¸°ì €ë²¡í„° $V$ë¥¼ êµ¬í•œ í›„, í˜„ì¬ í”„ë ˆì„ $z_t$ì— ëŒ€í•œ motion directionì„ ì¶”ì •

$$\mathbf{z}_{t}=\mathbf{z}_{t-1}+\lambda \cdot \mathbf{h}_{t} \cdot \mathbf{V}, \quad t=2,3, \cdots, n$$

#### Motion Diversity

- `motion mode collapse`: ìœ„ì— LSTM ì‹ì—ì„œ motionì„ ë‹¤ì–‘í•˜ê²Œ ì¡°ì ˆí•˜ê¸° ìœ„í•´ noise $\epsilon_{t}$ ë¥¼ ì¶”ê°€í–ˆì§€ë§Œ, LSTM decoderê°€ ì´ë¥¼ ë¬´ì‹œí•˜ëŠ” ë¬¸ì œê°€ ìˆì—ˆë‹¤ê³  í•¨
  - $G_M$ì´ ë‹¤ì–‘í•œ motion patternì„ captureí•˜ì§€ ëª»í•˜ê³ , íŠ¹ì • latent codeì— ëŒ€í•´ì„œ ë¹„ìŠ·í•œ motionë“¤ë§Œ ë§Œë“¤ì–´ëƒ„
- ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ $L_m$ lossë¥¼ ë„ì…í•˜ì—¬ hidden vector $h_t$ì™€ noise vector $\epsilon_{t}$ ì˜ <i>mutual information</i>ì´ maximizeë˜ë„ë¡ í•¨

$$\mathcal{L}_{\mathrm{m}}=\frac{1}{n-1} \sum_{t=2}^{n} \operatorname{sim}\left(H\left(\mathbf{h}_{t}\right), \epsilon_{t}\right)$$

---

## 2. Discriminator

### 2.1 Multi-Scale Video Discriminator $D_V$
- Discriminatorë¡œëŠ” multi-scale video discriminator $D_V$ ë¥¼ ì‚¬ìš©. 
- [PatchGAN architecture ê¸°ë°˜](https://happy-jihye.github.io/gan/gan-8/#322-markovian-discriminator-patchgan)
  - 2D ë³´ë‹¤ 3D conv layerê°€ modelingì„ ë” ì˜í•˜ë¯€ë¡œ 3D conv ì‚¬ìš©

- Adversarial í•˜ê²Œ í•™ìŠµ

$$\mathcal{L}_{D_{\mathrm{V}}}=\mathbb{E}_{\mathbf{v} \sim p_{v}}\left[\log D_{\mathrm{v}}(\mathbf{v})\right]+\mathbb{E}_{\mathbf{z}_{1} \sim p_{z}}\left[\log \left(1-D_{\mathrm{V}}\left(G_{\mathrm{I}}\left(G_{\mathrm{M}}\left(\mathbf{z}_{1}\right)\right)\right)\right)\right]$$

- ë‹¤ë§Œ `L_Dv Loss` ë§Œì„ ì´ìš©í•˜ì—¬ í•™ìŠµì„ í•˜ë©´, $\tilde{\mathbf{x}}_{t}$ ì˜ identity(content)ê°€ ì²«ë²ˆì§¸ ìƒì„± ì´ë¯¸ì§€ $\tilde{\mathbf{x}}_{1}$ ì™€ ë‹¬ë¼ì§ˆ ìˆ˜ë„ ìˆìŒ â¡ <b>Contrastive Image Discriminator</b>ë¥¼ ë„ì… !

### 2.2 Contrastive Image Discriminator $D_I$

> $\tilde{\mathbf{x}}_{t}$ ê³¼ $\tilde{\mathbf{x}}_{1}$ ê°„ì˜ contentì™€ image qualityê°€ match ë˜ëŠ”ì§€ë¥¼ íŒë³„

<b>Quality Matching</b>

$$\mathcal{L}_{D_{\mathrm{I}}}=\mathbb{E}_{\mathbf{z}_{1} \sim p_{z}}\left[\log D_{\mathrm{I}}\left(G_{\mathrm{I}}\left(\mathbf{z}_{1}\right)\right)\right]+\mathbb{E}_{\mathbf{z}_{1} \sim p_{z}, \mathbf{z}_{t} \sim G_{\mathrm{M}}\left(\mathbf{z}_{1}\right) \mid t>1}\left[\log \left(1-D_{\mathrm{I}}\left(G_{\mathrm{I}}\left(\mathbf{z}_{t}\right)\right)\right)\right]$$

<b>Content Matching</b>

- ì´ë¯¸ì§€ê°„ì˜ contentê°€ ê°™ë„ë¡ constrastive loss function $L_{constr}$ ë„ì…

$$\mathcal{L}_{\text {contr }}=-\sum_{i=1}^{N} \sum_{\alpha=a}^{b} \log \frac{\exp \left(\operatorname{sim}\left(F\left(\tilde{\mathbf{x}}_{t}^{(i a)}\right), F\left(\tilde{\mathbf{x}}_{t}^{(i b)}\right)\right) / \tau\right)}{\sum_{j=1}^{N} \sum_{\beta=a}^{b} \mathbb{1}_{[j \neq i]}\left(\exp \left(\operatorname{sim}\left(F\left(\tilde{\mathbf{x}}_{t}^{(i \alpha)}\right), F\left(\tilde{\mathbf{x}}_{t}^{(j \beta)}\right)\right) / \tau\right)\right.}$$

## 3. Full Objective

$$\min _{G_{M}}\left(\max _{D_{\mathrm{V}}} \mathcal{L}_{D_{\mathrm{V}}}+\max _{D_{\mathrm{I}}} \mathcal{L}_{D_{\mathrm{I}}}\right)+\max _{G_{\mathrm{M}}}\left(\lambda_{\mathrm{m}} \mathcal{L}_{\mathrm{m}}+\lambda_{\mathrm{f}} \mathcal{L}_{\mathrm{f}}\right)+\min _{D_{\mathrm{I}}}\left(\lambda_{\text {contr }} \mathcal{L}_{\text {contr }}\right)$$

---

## Result


<p align='center'><img src='https://github.com/happy-jihye/happy-jihye.github.io/blob/master/_posts/images/gan/mocoganhd-2.PNG?raw=1' width = '700' ></p>

<p align='center'>
  <iframe src="https://bluer555.github.io/MoCoGAN-HD/videos/FaceForensics.mp4"
    frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
    allowfullscreen style="width: 42.5em; height: 25em;"></iframe>
</p>

<p align='center'>
  <iframe src="https://bluer555.github.io/MoCoGAN-HD/videos/LSUN-Church.mp4"
    frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
    allowfullscreen style="width: 42.5em; height: 25em;"></iframe>
</p>

<p align='center'>
  <iframe src="https://bluer555.github.io/MoCoGAN-HD/videos/AFHQ-DOG-Interpolate_32.mp4"
    frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
    allowfullscreen style="width: 42.5em; height: 25em;"></iframe>
</p>


